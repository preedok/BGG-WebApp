const { DataTypes } = require('sequelize');
const sequelize = require('../config/sequelize');
const { BUSINESS_RULE_KEYS } = require('../constants');

/**
 * Business rules: global (branch_id null) or per branch.
 * Keys: bus_min_pack, bus_penalty_idr, handling_default_sar, require_hotel_with_visa, dp_grace_hours, dp_due_days, currency_rates.
 */
const BusinessRuleConfig = sequelize.define('BusinessRuleConfig', {
  id: {
    type: DataTypes.UUID,
    defaultValue: DataTypes.UUIDV4,
    primaryKey: true
  },
  key: {
    type: DataTypes.STRING(80),
    allowNull: false
  },
  value: {
    type: DataTypes.TEXT,
    allowNull: false,
    comment: 'JSON or string'
  },
  branch_id: {
    type: DataTypes.UUID,
    references: { model: 'branches', key: 'id' },
    comment: 'null = global (pusat)'
  },
  updated_by: {
    type: DataTypes.UUID,
    references: { model: 'users', key: 'id' }
  }
}, {
  tableName: 'business_rule_configs',
  underscored: true,
  timestamps: true,
  updatedAt: 'updated_at'
});

module.exports = BusinessRuleConfig;
